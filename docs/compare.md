## 场景

ECOS 是面向工业边缘环境的对象存储系统，其应用场景与传统的存储场景有以下区别：

- 硬件场景
    - ECOS 旨在部署于工业厂房，街区路边等有实时存储需求，但无法部署高性能服务器的区域
    - 假设：
        - 边缘节点的硬件资源受限，无大容量内存，SSD 等高性能硬件
        - 由于部署方案与传统的云服务中心不同，边缘集群扩容频率更高
        - 边缘节点故障概率更高
    
- 应用场景
    - 假设：
        - 存储数据大小两级分化：小文件（状态信息，日志），大文件 （监控数据，图片）
        
          

## 限制

- 没有专门的高性能服务器进行元数据的管理和读写 （元数据分片存储）
- 带宽和 CPU 资源受限，难以承受大规模数据迁移 （扩容后的数据迁移量需要尽可能小）
- 集群的部署需要尽可能简化 （节点之间自发现，自注册，自组织）



## 与 Ceph 架构对比

| 项目       | ECOS                                                 | Ceph                                                         | 注                                               |
| ---------- | ---------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------ |
| 系统架构   | 各节点地位对等，均为全能节点                         | 各节点角色不同 Monitor、OSD、Manager、RGW                    | 存储设施即插即用，无需复杂配置，适合边缘部署场景 |
| 寻址方法   | 计算寻址                                             | 计算寻址                                                     |                                                  |
| 写入策略   | 元数据读写策略与数据不同，元数据使用 rocksdb 存储    | RGW对象存储：Bucket 信息，对象索引等元数据信息也放置在 RADOS 对象内 | 在低性能服务器上提升元数据读写速度               |
| 一致性保证 | 使用 Raft 协议，通过元数据保证数据一致性             | 通过 PGLog 保证一致性，多副本需全部写入                      | 超半数写入即可提交，减少长尾效应                 |
| 扩容       | 记录历史集群状态信息，扩容仅需要迁移元数据           | 仅记录最新的集群信息，成员变更后需要迁移数据                 | 减少迁移数据量，适应于边缘网络                   |
| 负载均衡   | 不迁移数据，依靠更新节点权重通过新数据写入进行自平衡 | 调整节点权重后，数据需要进行迁移                             | 减少迁移数据量，适应于边缘网络                   |
| 小文件优化 | 小文件可以附加在元数据中，通过 rocksdb 存储          | 无小文件优化                                                 |                                                  |

